version: 2.1


orbs:
  orb: invocations/orb@dev:integration


workflows:
  main:
    jobs:
      - orb/lint:
          name: Lint
      - orb/format:
          name: Style check
      - orb/coverage:
          name: Test
      - orb/test-release:
          name: Release test
          requires: ["Test"]
      - orb/test:
          name: Integration (<< matrix.version >> & << matrix.pip-overrides >>)
          task: integration
          requires: ["Test"]
          matrix:
            # outer bounds (-ish) only for now. only so may free credits!
            parameters:
              version: ["3.6", "3.11"]
              pip-overrides: ["sphinx\\>=1.8,\\<2", "sphinx\\>2"]
      - orb/test:
          name: << matrix.version >> & << matrix.pip-overrides >>
          requires: ["Test"]
          matrix:
            parameters:
              version: ["3.7", "3.8", "3.9", "3.10", "3.11"]
              # Just test oldest/newest Sphinxes for now
              pip-overrides: ["sphinx\\>=1.8,\\<2", "sphinx\\>2"]
      - orb/docs:
          name: "Docs"
          requires: ["Test"]
          task: docs
